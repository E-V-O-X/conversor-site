<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conversor de Caixa (PT-BR)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial; background:#111; color:#eee; margin:0; padding:24px;}
    .wrap{max-width:900px; margin:0 auto; display:grid; gap:16px;}
    h1{font-size:22px; margin:0 0 8px}
    .grid{display:grid; gap:12px}
    @media (min-width:900px){ .cols{grid-template-columns:1fr 1fr}}
    textarea{width:100%; background:#1b1b1b; color:#eee; border:1px solid #333; border-radius:10px; padding:10px; box-sizing:border-box}
    button{background:#3b82f6; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer}
    button.secondary{background:#262626}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    small{color:#aaa}
    label{font-size:12px; color:#bbb}
    .card{background:#0f0f0f; border:1px solid #222; border-radius:14px; padding:16px}
  </style>
</head>
<body>
  <div class="wrap">
    <div>
      <h1>Conversor de Caixa (PT-BR)</h1>
      <small>Modos: MAIÚSCULAS, minúsculas, Primeira letra maiúscula (respeita pontuação).</small>
    </div>

    <div class="card grid cols">
      <div class="grid">
        <label>Texto de entrada</label>
        <textarea id="input" rows="10">EXEMPLO: A NASA E A UFRJ ANUNCIARAM ALGO EM 12 DE JUNHO. A MARIA DISSE: VAMOS AO RIO DE JANEIRO?

obs.: SR. JOÃO MORA NA AV. PAULISTA, 100. ETC. E TAL...</textarea>
      </div>
      <div class="grid">
        <label>Resultado</label>
        <textarea id="output" rows="10" readonly></textarea>
      </div>
    </div>

    <div class="card grid">
      <label>Modo</label>
      <div class="row">
        <button class="mode" data-mode="sentence">Primeira letra maiúscula</button>
        <button class="mode secondary" data-mode="upper">MAIÚSCULAS</button>
        <button class="mode secondary" data-mode="lower">minúsculas</button>
        <button id="convertNow" class="secondary">Converter</button>
        <button id="copy" class="secondary">Copiar</button>
        <button id="clear" class="secondary">Limpar</button>
      </div>
    </div>
  </div>

<script>
const LATIN_UPPER = "A-ZÀ-ÖØ-Þ";
const LATIN_LOWER = "a-zà-öø-ÿ";
function isLetter(ch){ return new RegExp(`[${LATIN_UPPER}${LATIN_LOWER}]`).test(ch); }

const DEFAULT_ABBR = ["sr.","sra.","srta.","dr.","dra.","prof.","profa.","etc.","p.ex.","ex.","aprox.","ilmo.","srs.","av.","r.","rod.","nº.","vs."];

function splitIntoSentences(text){
  const abbrSet = new Set(DEFAULT_ABBR);
  const out=[]; let buf="";
  const flush=()=>{ if(buf.length){ out.push(buf); buf=""; } };
  for(let i=0;i<text.length;i++){
    const ch=text[i]; buf+=ch;
    if(ch==="\n"){ if(text[i+1]==="\n"){ flush(); } continue; }
    if(/[\.!?…]/.test(ch)){
      let j=buf.length-2, word="";
      while(j>=0 && /[\p{L}\.]/u.test(buf[j])){ word = buf[j]+word; j--; }
      if(abbrSet.has(word.toLocaleLowerCase("pt-BR"))) continue;
      let k=i+1;
      while(/["'”’)\]\s]/.test(text[k])){ buf+=text[k]; i=k; k++; }
      flush();
    }
  }
  flush(); return out;
}

function sentenceCasePT(text){
  const sentences = splitIntoSentences(text);
  const processed = sentences.map((sentenceRaw)=>{
    const tokens = sentenceRaw.match(/\S+|\s+/g) || [];
    const lowered = tokens.map(tok=>{
      if(/^\s+$/.test(tok)) return tok;
      return tok.toLocaleLowerCase("pt-BR");
    });
    // primeira letra da sentença
    for (let i=0;i<lowered.length;i++){
      const t=lowered[i]; if(/^\s+$/.test(t)) continue;
      const idx=[...t].findIndex(c=>isLetter(c));
      if(idx!==-1){ const chars=[...t]; chars[idx]=chars[idx].toLocaleUpperCase("pt-BR"); lowered[i]=chars.join(""); break; }
    }
    // capitalizar após dois pontos
    for (let i=0;i<lowered.length;i++){
      if(lowered[i].includes(":")){
        for (let j=i+1;j<lowered.length;j++){
          if(/^\s+$/.test(lowered[j])) continue;
          const chars=[...lowered[j]]; const pos=chars.findIndex(c=>isLetter(c));
          if(pos!==-1){ chars[pos]=chars[pos].toLocaleUpperCase("pt-BR"); lowered[j]=chars.join(""); }
          break;
        }
      }
    }
    return lowered.join("");
  });
  return processed.join("");
}

function render(){
  const mode = document.querySelector(".mode:not(.secondary)")?.dataset.mode || "sentence";
  const input = document.getElementById("input").value;
  let out="";
  switch(mode){
    case "upper": out = input.toLocaleUpperCase("pt-BR"); break;
    case "lower": out = input.toLocaleLowerCase("pt-BR"); break;
    case "sentence":
    default: out = sentenceCasePT(input);
  }
  document.getElementById("output").value = out;
}

// UI
document.querySelectorAll(".mode").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll(".mode").forEach(b=>b.classList.add("secondary"));
    btn.classList.remove("secondary");
    render();
  });
});
document.getElementById("convertNow").onclick = render;
document.getElementById("copy").onclick = ()=>{ navigator.clipboard.writeText(document.getElementById("output").value); };
document.getElementById("clear").onclick = ()=>{ document.getElementById("input").value=""; render(); };
document.getElementById("input").addEventListener("input", render);
// Ativa modo padrão ao carregar
window.addEventListener("DOMContentLoaded", ()=>{
  const btn = document.querySelector(".mode[data-mode='sentence']");
  if (btn) { btn.classList.remove("secondary"); }
  render();
});
</script>
</body>
</html>
